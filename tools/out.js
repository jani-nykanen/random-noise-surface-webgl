'use strict';class h{constructor(a,b,c,d,e,f){this.s=f.length;this.j=a.createBuffer();this.f=null==c?null:a.createBuffer();this.b=null==d?null:a.createBuffer();this.a=null==e?null:a.createBuffer();this.h=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.j);a.bufferData(a.ARRAY_BUFFER,new Float32Array(b),a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this.f);a.bufferData(a.ARRAY_BUFFER,new Float32Array(c),a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this.b);a.bufferData(a.ARRAY_BUFFER,new Float32Array(d),
a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this.a);a.bufferData(a.ARRAY_BUFFER,new Float32Array(e),a.STATIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.h);a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(f),a.STATIC_DRAW)}bind(a){a.bindBuffer(a.ARRAY_BUFFER,this.j);a.vertexAttribPointer(0,3,a.FLOAT,a.o,0,0);null!=this.f&&(a.bindBuffer(a.ARRAY_BUFFER,this.f),a.vertexAttribPointer(1,2,a.FLOAT,a.o,0,0));null!=this.b&&(a.bindBuffer(a.ARRAY_BUFFER,this.b),a.vertexAttribPointer(2,3,a.FLOAT,a.o,0,
0));null!=this.a&&(a.bindBuffer(a.ARRAY_BUFFER,this.a),a.vertexAttribPointer(3,3,a.FLOAT,a.o,0,0));a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.h)}};function l(){return new m(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}function r(a){let b=new m;for(let c=0;4>c;++c)for(let d=0;4>d;++d)b.c[4*d+c]=a.c[4*c+d];return b}class m{constructor(){this.c=new Float32Array(16);this.c.fill(0);for(let a=0;a<Math.min(this.c.length,arguments.length);++a)this.c[a]=arguments[a]}multiply(a){let b=new m;for(let c=0;4>c;++c)for(let d=0;4>d;++d)for(let e=0;4>e;++e)b.c[4*c+d]+=this.c[4*c+e]*a.c[4*e+d];return b}clone(){let a=new m;a.c=Float32Array.from(this.c);return a}};class t{constructor(){this.model=l();this.view=l();this.h=l();this.b=l();this.f=l();this.a=!1}use(a){if(null!=a){if(!this.a){var b=this.view.multiply(this.model);this.b=this.h.multiply(b);this.a=!0}u(a,this.b);v(a,this.f)}}};function u(a,b){a.a.uniformMatrix4fv(a.b.transform,!1,r(b).c)}function v(a,b){a.a.uniformMatrix4fv(a.b.rotation,!1,r(b).c)}function w(a,b,c,d,e,f){let g=a.a;g.uniform3f(a.b.pos,b,c,0);g.uniform3f(a.b.size,d,e,f)}function z(a,b,c,d,e){let f=a.a;f.uniform2f(a.b.texPos,b,c);f.uniform2f(a.b.texSize,d,e)}
class A{constructor(a,b,c){this.a=a;this.b={};a=this.a;b=this.createShader(b,a.VERTEX_SHADER);var d=this.createShader(c,a.FRAGMENT_SHADER);c=a.createProgram();a.attachShader(c,b);a.attachShader(c,d);b=c;d=this.a;d.bindAttribLocation(b,0,"vertexPos");d.bindAttribLocation(b,1,"vertexUV");d.bindAttribLocation(b,2,"vertexNormal");d.bindAttribLocation(b,3,"vertexColor");a.linkProgram(c);if(!a.getProgramParameter(c,a.LINK_STATUS))throw"Shader error: "+a.getProgramInfoLog(c);this.f=a=c;a=this.a;c="transform rotation color t0 fogColor fogDensity lightDir lightMag pos size texPos texSize".split(" ");
for(let e of c)this.b[e]=a.getUniformLocation(this.f,e)}createShader(a,b){let c=this.a;b=c.createShader(b);c.shaderSource(b,a);c.compileShader(b);if(!c.getShaderParameter(b,c.COMPILE_STATUS))throw"Shader error:\n"+c.getShaderInfoLog(b);return b}use(){let a=this.a;a.useProgram(this.f);let b=l();a.uniform1i(this.b.t0,0);w(this,0,0,1,1,1);z(this,0,0,1,1);v(this,b);u(this,b);this.l(1,1,1,1)}l(a,b,c,d){this.a.uniform4f(this.b.color,a,b,c,d)}};const B={noTextureLight:"attribute vec3 vertexPos;\nattribute vec2 vertexUV;\nattribute vec3 vertexNormal;\nattribute vec3 vertexColor;\n   \nuniform mat4 transform;\nuniform mat4 rotation;\nuniform vec3 pos;\nuniform vec3 size;\nuniform vec3 lightDir;\nuniform vec4 color;\nuniform float lightMag;\n\nvarying float light;\nvarying vec4 faceColor;\n   \nvoid main() {\n    vec3 p = vertexPos * size + pos;\n    vec4 o = transform * vec4(p, 1);\n    gl_Position = o;\n    \n    vec3 rot = (rotation * vec4(vertexNormal,1)).xyz;\n    light = (1.0-lightMag) + lightMag * dot(rot, lightDir);\n\t\n\tfaceColor = color * vec4(vertexColor, 1.0);\n}",
texturedNoLight:"attribute vec3 vertexPos;\nattribute vec2 vertexUV;\nattribute vec3 vertexNormal;\nattribute vec3 vertexColor;\n   \nuniform mat4 transform;\nuniform mat4 rotation;\nuniform vec3 pos;\nuniform vec3 size;\nuniform vec3 lightDir;\nuniform float lightMag;\nuniform vec4 color;\n\nvarying vec2 uv;\nvarying vec4 faceColor;\n   \nvoid main() {\n    vec3 p = vertexPos * size + pos;\n    vec4 o = transform * vec4(p, 1);\n    gl_Position = o;\n    \n    uv = vertexUV;\n\tfaceColor = color * vec4(vertexColor, 1.0);\n}",
noTexture:"attribute vec3 vertexPos;\nattribute vec2 vertexUV;\nattribute vec3 vertexNormal;\nattribute vec3 vertexColor;\n   \nuniform mat4 transform;\nuniform vec3 pos;\nuniform vec3 size;\nuniform vec4 color;\n\nvarying vec4 faceColor;\n   \nvoid main() {\n    vec3 p = vertexPos * size + pos;\n    vec4 o = transform * vec4(p, 1);\n    gl_Position = o;\n\t\n\tfaceColor = color * vec4(vertexColor, 1.0);\n}"},C={fogAndLightNoTexture:"precision mediump float;\n \nuniform sampler2D t0;\nuniform vec4 fogColor;\nuniform float fogDensity;\n\nvarying float light;\nvarying vec4 faceColor;\n\nvec3 rgb222(vec3 v) {\n    float div = 85.0;\n    vec3 ret;\n    \n    float b1 = float(mod(gl_FragCoord.x, 2.0) == mod(gl_FragCoord.y, 2.0));\n    float b2 = 1.0 - b1;\n    ret.r = b1 * floor(v.r * 255.0 / (div / 2.0))\n          + b2 * ceil(v.r * 255.0 / (div / 2.0));\n    ret.g = b1 * floor(v.g * 255.0 / (div / 2.0))\n          + b2 * ceil(v.g * 255.0 / (div / 2.0));\n    ret.b = b1 * floor(v.b * 255.0 / (div / 2.0))\n          + b2 * ceil(v.b * 255.0 / (div / 2.0));\n    ret.r = floor(ret.r / 2.0) / 3.0;\n    ret.g = floor(ret.g / 2.0) / 3.0;\n    ret.b = floor(ret.b / 2.0) / 3.0;\n    \n    return ret;\n}\nvoid main() {\n\n    vec4 a = gl_FragCoord;\n    float z = a.z / a.w;\n    float d = z * fogDensity;\n    float fog = 1.0 / exp(d*d);\n    fog = clamp(fog, 0.0, 1.0);\n    gl_FragColor = vec4(\n        rgb222((1.0-light)*(fog*faceColor.xyz + (1.0-fog)*fogColor.xyz)), \n        faceColor.a);\n\t\t\n}",
lightNoTexture:"precision mediump float;\n \nuniform sampler2D t0;\nuniform vec4 fogColor;\nuniform float fogDensity;\n\nvarying float light;\nvarying vec4 faceColor;\n\nvec3 rgb222(vec3 v) {\n    float div = 85.0;\n    vec3 ret;\n    \n    float b1 = float(mod(gl_FragCoord.x, 2.0) == mod(gl_FragCoord.y, 2.0));\n    float b2 = 1.0 - b1;\n    ret.r = b1 * floor(v.r * 255.0 / (div / 2.0))\n          + b2 * ceil(v.r * 255.0 / (div / 2.0));\n    ret.g = b1 * floor(v.g * 255.0 / (div / 2.0))\n          + b2 * ceil(v.g * 255.0 / (div / 2.0));\n    ret.b = b1 * floor(v.b * 255.0 / (div / 2.0))\n          + b2 * ceil(v.b * 255.0 / (div / 2.0));\n    ret.r = floor(ret.r / 2.0) / 3.0;\n    ret.g = floor(ret.g / 2.0) / 3.0;\n    ret.b = floor(ret.b / 2.0) / 3.0;\n    \n    return ret;\n}\nvoid main() {\n\n    gl_FragColor = vec4(rgb222((1.0-light)*faceColor.xyz), faceColor.a);\n}",
fogNoTexture:"precision mediump float;\n \nuniform sampler2D t0;\nuniform vec4 fogColor;\nuniform float fogDensity;\n\nvarying vec4 faceColor;\n\n\nvec3 rgb222(vec3 v) {\n    float div = 85.0;\n    vec3 ret;\n    \n    float b1 = float(mod(gl_FragCoord.x, 2.0) == mod(gl_FragCoord.y, 2.0));\n    float b2 = 1.0 - b1;\n    ret.r = b1 * floor(v.r * 255.0 / (div / 2.0))\n          + b2 * ceil(v.r * 255.0 / (div / 2.0));\n    ret.g = b1 * floor(v.g * 255.0 / (div / 2.0))\n          + b2 * ceil(v.g * 255.0 / (div / 2.0));\n    ret.b = b1 * floor(v.b * 255.0 / (div / 2.0))\n          + b2 * ceil(v.b * 255.0 / (div / 2.0));\n    ret.r = floor(ret.r / 2.0) / 3.0;\n    ret.g = floor(ret.g / 2.0) / 3.0;\n    ret.b = floor(ret.b / 2.0) / 3.0;\n    \n    return ret;\n}\nvoid main() {\n\n    vec4 a = gl_FragCoord;\n    float z = a.z / a.w;\n    float d = z * fogDensity;\n    float fog = 1.0 / exp(d*d);\n    fog = clamp(fog, 0.0, 1.0);\n    gl_FragColor = vec4(\n        rgb222(fog*faceColor.xyz + (1.0-fog)*fogColor.xyz), \n        faceColor.a);\n}",
textured:"precision mediump float;\n \nuniform sampler2D t0;\nuniform vec2 texPos;\nuniform vec2 texSize;\n\nvarying vec2 uv;\nvarying float light;\nvarying vec4 faceColor;\n\nvec3 rgb222(vec3 v) {\n    float div = 85.0;\n    vec3 ret;\n    \n    float b1 = float(mod(gl_FragCoord.x, 2.0) == mod(gl_FragCoord.y, 2.0));\n    float b2 = 1.0 - b1;\n    ret.r = b1 * floor(v.r * 255.0 / (div / 2.0))\n          + b2 * ceil(v.r * 255.0 / (div / 2.0));\n    ret.g = b1 * floor(v.g * 255.0 / (div / 2.0))\n          + b2 * ceil(v.g * 255.0 / (div / 2.0));\n    ret.b = b1 * floor(v.b * 255.0 / (div / 2.0))\n          + b2 * ceil(v.b * 255.0 / (div / 2.0));\n    ret.r = floor(ret.r / 2.0) / 3.0;\n    ret.g = floor(ret.g / 2.0) / 3.0;\n    ret.b = floor(ret.b / 2.0) / 3.0;\n    \n    return ret;\n}\nvoid main() {\n    const float DELTA = 0.001;\n    vec2 tex = uv;    \n    tex.x *= texSize.x;\n    tex.y *= texSize.y;\n    tex += texPos;\n    vec4 res = texture2D(t0, tex) * faceColor;\n    if(res.a <= DELTA) {\n        discard;\n    }\n    gl_FragColor = vec4(rgb222(res.xyz), res.a);\n}",
noTexture:"precision mediump float;\n\nvarying vec4 faceColor;\n\nvec3 rgb222(vec3 v) {\n    float div = 85.0;\n    vec3 ret;\n    \n    float b1 = float(mod(gl_FragCoord.x, 2.0) == mod(gl_FragCoord.y, 2.0));\n    float b2 = 1.0 - b1;\n    ret.r = b1 * floor(v.r * 255.0 / (div / 2.0))\n          + b2 * ceil(v.r * 255.0 / (div / 2.0));\n    ret.g = b1 * floor(v.g * 255.0 / (div / 2.0))\n          + b2 * ceil(v.g * 255.0 / (div / 2.0));\n    ret.b = b1 * floor(v.b * 255.0 / (div / 2.0))\n          + b2 * ceil(v.b * 255.0 / (div / 2.0));\n    ret.r = floor(ret.r / 2.0) / 3.0;\n    ret.g = floor(ret.g / 2.0) / 3.0;\n    ret.b = floor(ret.b / 2.0) / 3.0;\n    \n    return ret;\n}\nvoid main() {\n    gl_FragColor = vec4(rgb222(faceColor.rgb), faceColor.a);\n}"};
function D(a,b,c){if(void 0==B[b]||void 0==C[c])throw"ERROR! Required shader sources do not exist: "+(void 0==B[b]?"Vertex: "+b+" ":"")+(void 0==C[c]?"Fragment: "+c:"");return new A(a,B[b],C[c])};function E(a){var b=100;void 0==b&&(b=64);let c=document.createElement("canvas");c.width=256;c.height=256;let d=c.getContext("2d");d.imageSmoothingEnabled=!1;d.font="bold 12px Arial";d.textAlign="center";d.fillStyle="#FFFFFF";for(var e=0;255>e;++e){var f=e%16*16+8;var g=16*Math.floor(e/16)+12;d.fillText(String.fromCharCode(e),f,g)}f=d.getImageData(0,0,256,256);g=f.data;for(e=0;e<g.length/4;++e)g[4*e]=255,g[4*e+1]=255,g[4*e+2]=255,g[4*e+3]=g[4*e+3]<b?0:255;d.putImageData(f,0,0);return new F(a,c)};class F{constructor(a,b){this.a=a.createTexture();a.bindTexture(a.TEXTURE_2D,this.a);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,b);this.width=b.width;this.height=b.height}bind(a){a.bindTexture(a.TEXTURE_2D,this.a)}}
function L(a,b,c){let d=document.createElement("div");d.setAttribute("style","position: absolute; top: 0; left: 0; z-index: -1;");a.b=document.createElement("canvas");a.b.width=b;a.b.height=c;a.b.setAttribute("style","position: absolute; top: 0; left: 0; z-index: -1;image-rendering: optimizeSpeed;image-rendering: pixelated;image-rendering: -moz-crisp-edges;");d.appendChild(a.b);document.body.appendChild(d);a.g=a.b.getContext("webgl",{alpha:!1,antialias:!1})}
function M(a){let b=a.g;b.activeTexture(b.TEXTURE0);b.enable(b.DEPTH_TEST);b.enable(b.BLEND);b.blendFuncSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA);b.enableVertexAttribArray(0);b.enableVertexAttribArray(1);b.enableVertexAttribArray(2);b.enableVertexAttribArray(3);b.viewport(0,0,a.width,a.height)}
function N(a){var b=window.innerWidth,c=window.innerHeight;a=a.b;let d;var e=Math.min(b/a.width|0,c/a.height|0);d=a.width*e;e*=a.height;c=String(c/2-e/2|0)+"px";b=String(b/2-d/2|0)+"px";a.style.height=String(e|0)+"px";a.style.width=String(d|0)+"px";a.style.top=c;a.style.left=b}function O(a,b){b=b?a.a.b:a.a.a;b!=a.i&&(a.i=b,a.i.use(),a.l(1,1,1,1),a.m.use(a.i))}
class P{constructor(a,b){this.g=this.b=null;this.width=a;this.height=b;L(this,a,b);M(this);N(this);this.a=[];this.a.a=D(this.g,"noTexture","noTexture");this.a.b=D(this.g,"texturedNoLight","textured");this.a.h=D(this.g,"noTextureLight","fogAndLightNoTexture");this.a.f=D(this.g,"texturedNoLight","fogNoTexture");this.a.j=D(this.g,"noTextureLight","lightNoTexture");this.i=this.a.a;this.i.use();this.j=this.f=null;this.h=new h(this.g,[0,0,0,1,0,0,1,1,0,0,1,0],[0,0,1,0,1,1,0,1],[0,0,-1,0,0,-1,0,0,-1,0,0,
-1],[1,1,1,1,1,1,1,1,1,1,1,1],[0,1,2,2,3,0]);this.m=new t;this.u=E(this.g);window.addEventListener("resize",()=>N(this))}clear(a,b,c){let d=this.g;d.clear(d.DEPTH_BUFFER_BIT|d.COLOR_BUFFER_BIT);d.clearColor(a,b,c,1)}bindTexture(a){a!=this.j&&(this.j=a,a.bind(this.g))}l(a,b,c,d){void 0==a?c=b=a=1:void 0==b&&(c=b=a);void 0==d&&(d=1);this.i.l(a,b,c,d)}fillRect(a,b,c,d){w(this.i,a,b,c,d,0);a=this.h;a!=this.f&&(this.f=a,a.bind(this.g));a=this.g;a.drawElements(a.TRIANGLES,this.h.s,a.UNSIGNED_SHORT,0)}}
;class Q{constructor(){}a(){}};class R{constructor(a){this.key=a;this.state=0}}function S(a,b,c){a.actions[b]=new R(c);a.b[c]=!0;return a}
class T{constructor(){this.a={};this.b={};this.actions={};window.addEventListener("keydown",a=>{var b=a.code;1!=this.a[b]&&(this.a[b]=3);this.b[b]&&a.preventDefault()});window.addEventListener("keyup",a=>{var b=a.code;0!=this.a[b]&&(this.a[b]=2);this.b[b]&&a.preventDefault()});window.addEventListener("contextmenu",a=>{a.preventDefault()});window.addEventListener("mousemove",()=>{window.focus()});window.addEventListener("mousedown",()=>{window.focus()})}update(){for(let a in this.actions)this.actions[a].state=
this.a[this.actions[a].key]|0}};function U(a,b){a.a+=b-a.h;a.a=Math.min(83.33335,a.a);a.h=b;b=a.a/16.66667|0;let c=!0;for(;0<b--;)c&&(a.b.input.update(),c=!1),a.a-=16.66667;a.f.a(a.j);window.requestAnimationFrame(d=>U(a,d))}class V{constructor(a,b){this.h=this.a=0;this.b={step:1,input:S(S(S(S(S(new T,"left","ArrowLeft"),"up","ArrowUp"),"right","ArrowRight"),"down","ArrowDown"),"start","Enter")};this.j=new P(a,b);this.f=new Q(this.b)}};class W extends Q{constructor(a){super(a)}a(a){a.clear(.7,.7,.7);a.g.disable(a.g.DEPTH_TEST);w(a.i,0,0,1,1,1);z(a.i,0,0,1,1);var b=a.m;b.model=l();b.f=l();b.a=!1;b=a.m;var c=a.width,d=a.height;b.view=l();var e=l();e.c[0]=2/(c-0);e.c[3]=-(c+0)/(c-0);e.c[5]=2/(0-d);e.c[7]=-(0+d)/(0-d);e.c[10]=-1;e.c[11]=-0;e.c[15]=1;c=e;b.h=c;b.a=!1;a.m.use(a.i);O(a,!1);a.l(1,0,0,1);a.fillRect(16,8,64,32);O(a,!0);b=a.u;d=b.width/16;{c=d;let k=b.width/16,x=2,G=2;let X=c/k,Y=d/k;for(let y=0;12>y;++y){var f="Hello world!".charCodeAt(y);
if(10==f)x=2,G+=(k+0)*Y;else{e=a;var g=b,n=f%16*k;f=(f/16|0)*k;var H=k,I=k,J=x,K=G,p=c,q=d;null==p&&(p=H);null==q&&(q=I);0>p&&(J-=p);0>q&&(K-=q);w(e.i,J,K,p,q,0);z(e.i,n/g.width,f/g.height,H/g.width,I/g.height);n=e;f=e.h;f!=n.f&&(n.f=f,f.bind(n.g));e.bindTexture(g);g=e.g;g.drawElements(g.TRIANGLES,e.h.s,g.UNSIGNED_SHORT,0);x+=(k+-8)*X}}}}};window.onload=()=>{var a=new V(256,192);a.f=new W.prototype.constructor(a.b);U(a,0)};
